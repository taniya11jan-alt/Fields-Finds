{% extends 'core/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm border-0" style="border-radius: 20px; background-color: #F4F1EA;">
            <div class="card-header text-white p-3" style="background-color: var(--village-green); border-radius: 20px 20px 0 0;">
                <h5 class="mb-0">üí¨ Chat: {{ booking.tool.name }}</h5>
                <small>With {{ booking.tool.owner.first_name }} / {{ booking.borrower.first_name }}</small>
            </div>

            <div class="card-body" style="height: 400px; overflow-y: auto; background-image: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png');">
                {% for msg in messages_list %}
                    <div class="d-flex {% if msg.sender == request.user %}justify-content-end{% else %}justify-content-start{% endif %} mb-3">
                        <div class="p-3 shadow-sm" style="max-width: 75%; border-radius: 15px; 
                            {% if msg.sender == request.user %}
                                background-color: var(--leaf-green); color: white; border-bottom-right-radius: 2px;
                            {% else %}
                                background-color: white; color: #333; border-bottom-left-radius: 2px;
                            {% endif %}">
                            <p class="mb-1">{{ msg.content }}</p>
                            <small style="font-size: 0.7rem; opacity: 0.8;">{{ msg.timestamp|date:"H:i" }}</small>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-center text-muted mt-5">No messages yet. Say Namaste!</p>
                {% endfor %}
            </div>

            <div class="card-footer bg-white border-0 p-3" style="border-radius: 0 0 20px 20px;">
                <form method="POST" class="d-flex">
                    {% csrf_token %}
                    <input type="text" name="content" class="form-control me-2 border-0 bg-light" placeholder="Type your message..." required style="border-radius: 25px;">
                    <button type="submit" class="btn btn-green rounded-circle" style="width: 45px; height: 45px; padding: 0;">
                        ‚û§
                    </button>
                </form>
            </div>
        </div>
        <div class="text-center mt-3">
            <a href="{% url 'dashboard' %}" class="text-muted small">‚Üê Back to Dashboard</a>
        </div>
    </div>
</div>
{% endblock %}